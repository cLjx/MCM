clear 
clc
% 第二问的那个lamada1 2 3 4 及仿真图比例
fengji=8;
pinpushu=30;
jiaodushu=30;
  
mytheta=15;
mytheta=mytheta/180*pi;
ljx=500;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
ca=ones(ljx,ljx)*3;

% 3 2.438306 16.444115  4.053570
% 5 1.462983 9.866469   2.432142
% 7 1.044989 7.047480   1.737244
% 9 0.812770 5.481373   1.351190
% 11 0.664988 4.484760  1.105519
% 13 0.562683 3.794799  0.935439
% 15 0.487659 3.288826  0.810714
% 17 0.430288 2.901905  0.715336

wavewmin = [2.438306 1.462983 1.044989 0.812770 0.664988 0.562683 0.487659 0.430288];
wavewmax = [16.444115 9.866469 7.047480 5.481373 4.484760 3.794799 3.288826 2.90190];
wavewp=[4.053570 2.432142 1.737244 1.351190 1.105519 0.935439 0.810714 0.715336];

%-----------------------------------------------------
u=[3,5,7,9,11,13,15,17];
%---------------------------------------------------

if fengji>8
    fengji=8;
end
if fengji<1
    fengji=1;
end
fi=fengji;
wmin=wavewmin(fi);
wmax=wavewmax(fi);
wp=wavewp(fi);
ui=u(fi);
M=pinpushu;
N=jiaodushu;
wavewn=(wmax-wmin)/M;
thetawn=pi/N;
dx=1;
dy=1;
x=[0:dx:ljx];
y=[0:dy:ljx];
[x,y]=meshgrid(x,y);

for ininindex=1:100
    ininindex


z=zeros(size(x));
for wi=1:M
    for ki=1:N
        theta=-pi/2+(ki-1)*thetawn;
         epsin=rand*2*pi;
         w=wmin+(wi-1)*wavewn+wavewn/2;
         swi=0.81*exp(-7400/(w*ui+eps).^4)*2*(cos(theta)).^2/(pi*(w.^5+eps));
        an=sqrt(2*swi*wavewn*theta);
       z1=w*w*x*cos(theta)/9.8+w*w*y*sin(theta)/9.8+epsin;
       z=an*cos(z1)+z;
    end
end
% subplot(1,2,1)
% surf(x,y,real(z))

% surfl(x,y,real(z));
% set(gca,'xtick',[],'ytick',[],'xcolor','w','ycolor','w')
% shading interp;
% lightangle(-45,30);
% set(findobj(gca,'type','surface'),'FaceLighting','phong','AmbientStrength',.3,'DiffuseStrength',.8,...
%     'SpecularStrength',.9,'SpecularExponent',200)


index=0;index1=0;index2=0;
indexx=zeros(1,ljx-1);
indexy=zeros(1,ljx-1);

%------------------------------------



for i=2:ljx
    for j=2:ljx
        myalpha=atan((z(j+1,i)-z(j,i))/1);
        if mytheta-2*myalpha<=0
            index=index+1;
%             plot3(i,j,z(j,i),'.','Color','r','MarkerSize',6)
            ca(i,j)=4;
            
            
            else
%             pi/2-mytheta+myalpha-myalpha
ljxljx(j)=abs(myalpha);
            if abs(myalpha)>=0.17 && abs(myalpha)<=0.19
                ca(i,j)=1;index1=index1+1;
            end
            if abs(myalpha)<=0.03
                    ca(i,j)=2;index2=index2+2;
                
            end
            
        end
        myalpha=atan((z(i+1,j)-z(i,j))/1);
        if mytheta-2*myalpha<=0
            index=index+1;
%             plot3(i,j,z(j,i),'.','Color','r','MarkerSize',6)
            ca(i,j)=4;
            
            
        else
%             pi/2-mytheta+myalpha-myalpha
ljxljx(j)=abs(myalpha);
            if abs(myalpha)>=0.17 && abs(myalpha)<=0.19
                ca(i,j)=1;index1=index1+1;
            end
            if abs(myalpha)<=0.03
                    ca(i,j)=2;index2=index2+2;
                
            end
            
            
        end
    end
end
lose=index;
losePercent=index/(ljx-2)/(ljx-2);
%% ca
% figure
% hold off
% % subplot(1,2,2)
% imagesc(ca);
% Map = [0 255 0;0 0 100;0,0,205;255 0 0]/255;colormap(Map);
% set(gca,'xtick',[],'ytick',[],'xcolor','w','ycolor','w')
%%
my(ininindex,:)=[index1 index2 (ljx-1)^2-index-index1-index2 index]/(ljx-1)^2;
end


my=[0.120095903229304,0.149718274223798,0.516218810366223,0.213967012180674;0.116923225207931,0.146842783763921,0.516194714077454,0.220039276950695;0.113879060726664,0.146344793796009,0.489222934847651,0.250553210629676;0.115413191111682,0.141509471849511,0.475311344131148,0.267765992907659;0.107718442897820,0.161204171870796,0.500773089264702,0.230304295966683;0.118320809956587,0.144818695507247,0.510981883606893,0.225878610929273;0.123991469913775,0.142617901132927,0.508732896655034,0.224657732298264;0.115838892213284,0.143758458801370,0.504652591756660,0.235750057228686;0.111413207175875,0.161959188918920,0.501134533596251,0.225493070308955;0.114248537154469,0.146939168919000,0.502644567692499,0.236167726234031;0.121557744748013,0.138232376576801,0.508218842494609,0.231991036180578;0.118850928309525,0.145878932213124,0.515503953799382,0.219766185677969;0.115951341560877,0.153107818844101,0.500668672013365,0.230272167581656;0.123630025582227,0.140995417689086,0.505046164473235,0.230328392255453;0.120826823988659,0.145091786779973,0.501463849542773,0.232617539688596;0.116136079774780,0.142248424705122,0.511118429243256,0.230497066276842;0.118304745764073,0.144641989389601,0.493062276858326,0.243990987988000;0.118947313464605,0.145204236127566,0.507166637884988,0.228681812522841;0.121220396705234,0.137123947293384,0.483568339082976,0.258087316918406;0.121244492994004,0.140015501945775,0.487303263842314,0.251436741217907;0.121011562202561,0.147437158886912,0.492379548676511,0.239171730234015;0.115405159015426,0.153943156854792,0.506283107296758,0.224368576833025;0.116063790908470,0.152802599186349,0.502459829478597,0.228673780426585;0.115871020598311,0.146890976341460,0.502869466387685,0.234368536672543;0.117846916277445,0.135533592234569,0.496443789382372,0.250175702105614;0.113517616395115,0.150987345432348,0.500475901703206,0.235019136469331;0.115597929325585,0.148015469817390,0.506508005991944,0.229878594865081;0.122160151967261,0.141734370544697,0.504050184537412,0.232055292950631;0.113951349592974,0.154457211015217,0.497592379147072,0.233999060244738;0.114521628427195,0.154907008405589,0.496475917767399,0.234095445399818;0.117043706651781,0.149734338416312,0.486186802462641,0.247035152469267;0.114826848084947,0.153654001389553,0.502066256762021,0.229452893763479;0.114063798940567,0.149123899100807,0.491118509564219,0.245693792394408;0.114449339560885,0.150360841924330,0.489046228730005,0.246143589784780;0.117381054694559,0.153075690459074,0.523335247649608,0.206208007196758;0.120296705635720,0.141654049582130,0.504186730173774,0.233862514608375;0.116979449881727,0.147196195999213,0.506684712109590,0.229139642009470;0.118626029614339,0.154007413624845,0.523423600708431,0.203942956052385;0.116433267336276,0.154569660362810,0.500419677029410,0.228577395271505;0.113565808972655,0.161091722523203,0.493479945863671,0.231862522640471;0.116794711667825,0.147164067614186,0.500010040120321,0.236031180597668;0.109164220224015,0.158264424640865,0.504323275810137,0.228248079324983;0.120746503026092,0.139180163935085,0.510066224633636,0.230007108405187;0.115180260320240,0.148818679443054,0.511335295842185,0.224665764394521;0.111710394737371,0.165637889004462,0.510748952815451,0.211902763442717;0.121115979453898,0.147003425689053,0.496275115360983,0.235605479496066;0.115517608363019,0.149011449753214,0.498716872623002,0.236754069260766;0.120023614362995,0.137348845988570,0.508797153425087,0.233830386223349;0.113814803956611,0.156947160854776,0.499937751254011,0.229300283934603;0.111541720715981,0.156674069582050,0.487769125425199,0.244015084276770;0.116312785892426,0.142489387592821,0.500989955863631,0.240207870651122;0.112891112887097,0.149011449753214,0.482162722238063,0.255934715121626;0.117059770844294,0.154135927164951,0.503375488451854,0.225428813538901;0.120979433817535,0.150168071614170,0.494138577756716,0.234713916811579;0.111445335560901,0.152111838908277,0.504917650933129,0.231525174597692;0.114585885197248,0.144818695507247,0.495857446355637,0.244737972939868;0.118087879165144,0.135356886116923,0.504034120344898,0.242521114373035;0.115252549186549,0.152304609218437,0.493961871639070,0.238480969955944;0.121919189079562,0.136593828940446,0.495825317970611,0.245661664009382;0.117124027614347,0.151549592170313,0.506580294858254,0.224746085357087;0.116947321496701,0.151003409624861,0.495182750270079,0.236866518608359;0.119445303432516,0.148513459785302,0.498074304922470,0.233966931859711;0.116609973453922,0.155662025453713,0.524242874526608,0.203485126565757;0.118336874149100,0.136931176983225,0.511544130344858,0.233187818522817;0.119260565218614,0.144176127806716,0.508291131360918,0.228272175613753;0.118039686587604,0.146537564106168,0.493295207649769,0.242127541656459;0.120336866117004,0.144899016469813,0.516347323906330,0.218416793506853;0.117027642459267,0.145204236127566,0.497471897703222,0.240296223709945;0.115485479977992,0.147260452769266,0.489849438355669,0.247404628897073;0.118425227207923,0.142794607250573,0.504170665981261,0.234609499560243;0.117485471945896,0.144160063614202,0.492419709157795,0.245934755282107;0.123180228191855,0.143324725603512,0.496371500516062,0.237123545688572;0.118489483977976,0.152529507913623,0.495255039136389,0.233725968972012;0.109573857133104,0.150537548041976,0.500130521564170,0.239758073260750;0.122336858084907,0.138328761731881,0.499070284858294,0.240264095324918;0.114706366641098,0.148384946245196,0.499841366098931,0.237067321014775;0.117766595314878,0.135854876084835,0.497487961895735,0.248890566704551;0.117405150983329,0.139662089710483,0.484821346099012,0.258111413207176;0.115027650491363,0.150232328384223,0.508186714109582,0.226553307014831;0.115453351592965,0.148738358480488,0.494588375147088,0.241219914779459;0.119766587282782,0.144320705539335,0.494676728205911,0.241235978971972;0.118810767828242,0.147935148854824,0.521528025991864,0.211726057325071;0.116288689603656,0.151164051549994,0.503327295874314,0.229219962972036;0.120184256288127,0.139565704555403,0.506773065168413,0.233476973988056;0.121083851068871,0.139967309368235,0.498106433307497,0.240842406255397;0.118352938341613,0.141895012469829,0.505680700077510,0.234071349111048;0.118031654491347,0.146473307336115,0.482042240794214,0.253452797378324;0.112136095838973,0.155902988341412,0.497214870623010,0.234746045196606;0.116585877165152,0.150585740619516,0.512178665949133,0.220649716266200;0.116071823004727,0.153220268191694,0.490732968943900,0.239974939859679;0.113999542170513,0.153396974309340,0.509921646901017,0.222681836619130;0.117501536138409,0.143308661410998,0.503704804398376,0.235484998052217;0.119244501026100,0.155951180918952,0.500106425275401,0.224697892779547;0.115356966437886,0.154521467785270,0.503118461371641,0.227003104405203;0.112722438865707,0.148401010437709,0.484692832558905,0.254183718137678;0.116192304448577,0.147372902116859,0.512909586708487,0.223525206726077;0.120674214159783,0.147565672427018,0.512443725125602,0.219316388287597;0.117718402737338,0.151131923164967,0.522138465307368,0.209011208790326;0.114449339560885,0.148047598202417,0.501102405211224,0.236400657025474;0.120834856084915,0.141268508961811,0.501134533596251,0.236762101357023;]

figure 
subplot(2,2,1)
plot(my(:,1)),title('\lambda_1');hold on
plot(ones(1,100)*mean(my(:,1)'),'r');hold off
subplot(2,2,2)
plot(my(:,2)),title('\lambda_2');hold on
plot(ones(1,100)*mean(my(:,2)'),'r');hold off
subplot(2,2,3)
plot(my(:,3)),title('\lambda_3');hold on
plot(ones(1,100)*mean(my(:,3)'),'r');hold off
subplot(2,2,4)
plot(my(:,4)),title('\lambda_4');hold on
plot(ones(1,100)*mean(my(:,4)'),'r');hold off
[mean(my(:,1)')
mean(my(:,2)')
mean(my(:,3)')
mean(my(:,4)')]

10*log10(0.1477)+0.5014*6-10*log10(0.1368)-0.5036*6

